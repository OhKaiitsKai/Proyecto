<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pantry Pursuit: Supermarket</title>
    <style>
        .divider {
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            background-color: #000;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from "./three.module.js";
        import { OrbitControls } from "./OrbitControls.js";
        import { MTLLoader } from "./MTLLoader.js";
        import { OBJLoader } from "./OBJLoader.js";

        const scene1 = new THREE.Scene();
        const scene2 = new THREE.Scene();

        // Load background texture
        const textureLoader = new THREE.TextureLoader();
        const backgroundTexture = textureLoader.load('supermarket.jpg', (texture) => {
            texture.mapping = THREE.EquirectangularReflectionMapping;
            texture.encoding = THREE.sRGBEncoding;
            scene1.background = texture;
            scene2.background = texture;
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === "Escape") {
                window.location.href = "Pausa.html";
            }
        });

        const camera1 = new THREE.PerspectiveCamera(75, window.innerWidth / 2 / window.innerHeight, 0.1, 1000);
        camera1.position.set(0, 3, 5);

        const renderer1 = new THREE.WebGLRenderer();
        renderer1.setSize(window.innerWidth / 2, window.innerHeight);
        renderer1.domElement.style.position = "absolute";
        renderer1.domElement.style.top = "0";
        renderer1.domElement.style.left = "0";
        document.body.appendChild(renderer1.domElement);

        const Cam1Control = new OrbitControls(camera1, renderer1.domElement);
        Cam1Control.listenToKeyEvents(window);
        Cam1Control.keys = { LEFT: 'KeyA', UP: 'KeyW', RIGHT: 'KeyD', BOTTOM: 'KeyS' };
        Cam1Control.enableZoom = false;
        Cam1Control.enableRotate = false;

        const camera2 = new THREE.PerspectiveCamera(75, window.innerWidth / 2 / window.innerHeight, 0.1, 1000);
        camera2.position.set(0, 3, 5);

        const renderer2 = new THREE.WebGLRenderer();
        renderer2.setSize(window.innerWidth / 2, window.innerHeight);
        renderer2.domElement.style.position = "absolute";
        renderer2.domElement.style.top = "0";
        renderer2.domElement.style.left = `${window.innerWidth / 2}px`;
        document.body.appendChild(renderer2.domElement);

        const Cam2Control = new OrbitControls(camera2, renderer2.domElement);
        Cam2Control.listenToKeyEvents(window);
        Cam2Control.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };
        Cam2Control.enableZoom = false;
        Cam2Control.enableRotate = false;

        const addSupermarketElements = (scene) => {
            const floorGeometry = new THREE.PlaneGeometry(100, 100);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0xCED6C4, transparent: true, opacity: 0.8 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            const shelfGeometry = new THREE.BoxGeometry(2, 1, 0.5);
            const shelfMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            for (let i = 0; i < 4; i++) {
                const shelf = new THREE.Mesh(shelfGeometry, shelfMaterial);
                shelf.position.set(i * 2 - 3, 0.5, -2);
                scene.add(shelf);
            }

            const ambientLight = new THREE.AmbientLight(0x404040, 0.7);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xFFFFFF, 1.5);
            directionalLight.position.set(1, 3, 2);
            scene.add(directionalLight);
        };

        addSupermarketElements(scene1);
        addSupermarketElements(scene2);

        let cart1, cart2;
        const loadCartModel = (scene, setCartVariable) => {
            const mtlLoader = new MTLLoader();
            mtlLoader.setPath('Modelos/Carrito/');
            mtlLoader.load('carrito.mtl', (materials) => {
                materials.preload();
                const objLoader = new OBJLoader();
                objLoader.setMaterials(materials);
                objLoader.setPath('Modelos/Carrito/');
                objLoader.load('carrito.obj', (object) => {
                    const texture = textureLoader.load('Texturas/carritoP1.png');
                    texture.encoding = THREE.sRGBEncoding;
                    object.traverse((child) => {
                        if (child.isMesh) {
                            child.material.map = texture;
                            child.material.color.set(0xFFFFFF);
                        }
                    });
                    object.position.set(0, .35, 0);
                    scene.add(object);
                    setCartVariable(object);
                });
            });
        };

        loadCartModel(scene1, (cart) => { cart1 = cart; });
        loadCartModel(scene2, (cart) => { cart2 = cart; });

        const moveSpeed = 0.1;
        const rotateSpeed = 0.02;
        let velocity1 = new THREE.Vector3();
        let velocity2 = new THREE.Vector3();
        const acceleration = 0.01;
        const deceleration = 0.98;

        const keys1 = {};
        const keys2 = {};

        document.addEventListener('keydown', (e) => {
            keys1[e.code] = true;
            keys2[e.code] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys1[e.code] = false;
            keys2[e.code] = false;
        });

        function animate() {
            requestAnimationFrame(animate);

            if (cart1) {
                const direction1 = new THREE.Vector3();
                cart1.getWorldDirection(direction1);
                if (keys1['KeyW']) {
                    velocity1.add(direction1.multiplyScalar(acceleration));
                }
                if (keys1['KeyS']) {
                    velocity1.add(direction1.multiplyScalar(-acceleration));
                }
                if (keys1['KeyA']) {
                    cart1.rotation.y += rotateSpeed;
                }
                if (keys1['KeyD']) {
                    cart1.rotation.y -= rotateSpeed;
                }
                cart1.position.add(velocity1);
                velocity1.multiplyScalar(deceleration);

                camera1.position.set(cart1.position.x, cart1.position.y + 3, cart1.position.z + 5);
                camera1.lookAt(cart1.position);
            }

            if (cart2) {
                const direction2 = new THREE.Vector3();
                cart2.getWorldDirection(direction2);
                if (keys2['ArrowUp']) {
                    velocity2.add(direction2.multiplyScalar(acceleration));
                }
                if (keys2['ArrowDown']) {
                    velocity2.add(direction2.multiplyScalar(-acceleration));
                }
                if (keys2['ArrowLeft']) {
                    cart2.rotation.y += rotateSpeed;
                }
                if (keys2['ArrowRight']) {
                    cart2.rotation.y -= rotateSpeed;
                }
                cart2.position.add(velocity2);
                velocity2.multiplyScalar(deceleration);

                camera2.position.set(cart2.position.x, cart2.position.y + 3, cart2.position.z + 5);
                camera2.lookAt(cart2.position);
            }

            renderer1.render(scene1, camera1);
            renderer2.render(scene2, camera2);
        }

        animate();
    </script>

    <div class="divider"></div>
</body>
</html>







